<div class="space-y-6">
  <%= render "ui/card" do %>
    <%= render "ui/card/header", classes: "flex items-center justify-between" do %>
      <div>
        <%= render "ui/card/description", content: @model.name %>
        <%= render "ui/card/title", content: "Record" %>
      </div>
      <div class="flex gap-2">
        <%= render "ui/navigation_menu/link", href: darwin.edit_record_path(@model.name.pluralize.underscore, @record), trigger_style: true do %>
          Edit
        <% end %>
        <%= render "ui/navigation_menu/link", href: darwin.records_path(@model.name.pluralize.underscore), trigger_style: true do %>
          Back
        <% end %>
      </div>
    <% end %>

    <%= render "ui/card/content", classes: "space-y-6" do %>
      <div class="grid gap-3">
        <% @model.runtime_constant.columns.each do |column| %>
          <% next if @model.runtime_constant.reflect_on_all_associations(:belongs_to).map(&:foreign_key).include?(column.name) %>
          <div class="grid gap-1">
            <span class="text-xs uppercase tracking-wide text-muted-foreground"><%= column.name.humanize %></span>
            <span class="text-sm text-foreground"><%= @record.send(column.name) %></span>
          </div>
        <% end %>
      </div>

      <div class="space-y-4">
        <% @model.runtime_constant.reflect_on_all_associations(:belongs_to).each do |association| %>
          <% associated_record = @record.send(association.name) %>
          <div class="grid gap-1">
            <span class="text-xs uppercase tracking-wide text-muted-foreground"><%= association.name.to_s.humanize %></span>
            <% if associated_record %>
              <% associated_model = Darwin::Model.find_by(name: association.klass.name) %>
              <% if associated_model %>
                <% link_path = darwin.record_path(associated_model.name.pluralize.underscore, associated_record) %>
                <%= link_to associated_record.to_s, link_path, class: "text-primary underline-offset-4 hover:underline" %>
              <% else %>
                <span class="text-sm"><%= associated_record.to_s %></span>
              <% end %>
            <% else %>
              <span class="text-sm text-muted-foreground">None</span>
            <% end %>
          </div>
        <% end %>
      </div>

      <div class="space-y-4">
        <% (@model.runtime_constant.reflect_on_all_associations(:has_many) + @model.runtime_constant.reflect_on_all_associations(:has_one)).each do |association| %>
          <% associated_records = Array.wrap(@record.send(association.name)) %>
          <div class="space-y-2">
            <span class="text-xs uppercase tracking-wide text-muted-foreground"><%= association.name.to_s.humanize %></span>
            <div class="space-y-1">
              <% if associated_records.any? %>
                <% associated_records.each do |associated_record| %>
                  <% associated_model = Darwin::Model.find_by(name: association.klass.name) %>
                  <% if associated_model %>
                    <% link_path = darwin.record_path(associated_model.name.pluralize.underscore, associated_record) %>
                    <div><%= link_to associated_record.to_s, link_path, class: "text-sm text-primary underline-offset-4 hover:underline" %></div>
                  <% else %>
                    <div class="text-sm"><%= associated_record.to_s %></div>
                  <% end %>
                <% end %>
              <% else %>
                <div class="text-sm text-muted-foreground">None</div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  <% end %>
</div>
