<%= content_for :heading, "Editing" %>
<%= content_for :subheading, @model.name %>
<%= content_for :nav_items do %>
<%= render "ui/navigation_menu/item" do %>
<%= render "ui/navigation_menu/link", href: darwin.root_path, trigger_style: true do %>
Back
<% end %>
<% end %>
<% end %>


<div class="space-y-8">

  <div class="grid gap-2">


    <p class="text-xs font-semibold uppercase tracking-wide text-muted-foreground">Table</p>
    <div class="flex flex-wrap gap-2 text-sm text-muted-foreground">
      <%= render UI::Dialog.new(attributes: { id: "phlex-edit-profile" }) do %>
      <%= render UI::DialogTrigger.new { @runtime_class.name.split("::").last } %>
      <%= render UI::DialogOverlay.new do %>
      <%= render UI::DialogContent.new(classes: "sm:max-w-[425px]") do %>
      <%= render UI::DialogHeader.new do %>
      <%= render UI::DialogTitle.new { "Edit #{@runtime_class.name.split("::").last}" } %>
      <%= render UI::DialogDescription.new { "Rename table: #{@runtime_class.table_name}" } %>
      <% end %>

      <%= form_with(model: @model, url: darwin.model_path(@model)) do |form| %>
      <% name_field_id = form.field_id(:name) %>
      <% name_field_name = form.field_name(:name) %>

      <%= render "ui/field" do %>
      <%= render "ui/field/label", for_id: name_field_id, classes: "text-right text-sm font-medium" do %>Name<% end %>
      <%= render "ui/field/content" do %>
      <%= render "ui/input", id: name_field_id, name: name_field_name, value: form.object.name, class: "col-span-3 flex h-9 w-full rounded-md border bg-transparent px-3 py-1 text-sm"%>
      <% end %>
      <% if form.object.errors[:name].any? %>
      <%= render "ui/field/error", content: form.object.errors.full_messages_for(:name).to_sentence %>
      <% end %>
      <% end %>
      <%= render UI::DialogFooter.new do %>
      <%= render "ui/button", classes: "mt-2", type: "submit" do %>Save Changes<% end %>
      <% end %>
      <% end %>

      <% end %>
      <% end %>
      <% end %>
    </div>
 
    <p class="text-xs font-semibold uppercase tracking-wide text-muted-foreground">Columns</p>
<div id="columns-list" class="flex flex-wrap gap-2 text-sm text-muted-foreground">
  <%= render collection: @runtime_class.columns.drop(3), partial: "darwin/models/table/column" %>
</div>

    <%# NEW COLUMN FORM HERE %>
    <!-- Does this even hit the add column action? -->
    <%= form_with url: darwin.columns_model_path(@model), method: :post, data: { controller: "columns", action: "submit->columns#submit change->columns#submit" }, html: { class: "flex items-center gap-2 mt-3" } do %>
      <%= text_field_tag "column[name]", nil, placeholder: "column name", class: "h-9 rounded-md border px-3 py-2 text-sm", required: true, data: { "columns-target": "nameField", action: "blur->columns#normalizeName" } %>
      <%= select_tag "column[type]",
                     options_for_select(%w[string text integer float decimal boolean date datetime]),
                     prompt: "Type",
                     class: "h-9 rounded-md border px-3 py-2 text-sm",
                     required: true %>
      <%= render "ui/button", variant: "outline", type: "submit" do %>Add column<% end %>
    <% end %>


    </div>
  </div>


  <p class="text-xs font-semibold uppercase tracking-wide text-muted-foreground">Blocks</p>
    <div id="blocks" class="flex w-full max-w-md flex-col gap-2">
      <%= render @model.blocks %>
    </div>

  <div class="flex flex-wrap gap-2">
    <% available_method_names(@model).each do |method_name| %>
    <% next if method_name.in?(%w[validates attribute]) %>
    <%= form_with url: darwin.model_blocks_path(@model), method: :post, html: { class: "inline-block" } do %>
    <%= hidden_field_tag "darwin_block[method_name]", method_name %>
    <%= render "ui/button", variant: "outline", type: "submit" do %>
    Add <%= method_name.humanize %>
    <% end %>
    <% end %>
    <% end %>


    <% if @runtime_class&.attribute_names&.any? %>
    <%= form_with url: darwin.model_blocks_path(@model), method: :post, html: { class: "inline-flex items-center gap-2" } do %>
    <%= hidden_field_tag "darwin_block[method_name]", "validates" %>
    <%= select_tag "darwin_block[args_name]",
    options_for_select(@runtime_class.attribute_names.map { |n| [n.humanize, n] }),
    prompt: "Add validation",
    class: "inline-flex h-9 items-center rounded-md border px-3 py-2 text-sm",
     onchange: "this.form.submit()" %>
     <% end %>
     <% end %>
   </div>
 </div>
