<% model ||= local_assigns[:model] || @model %>
<% frame_id = local_assigns[:frame_id] || dom_id(block) %>

<%= turbo_frame_tag frame_id do %>
  <div class="space-y-3 rounded-md border border-slate-200 bg-white p-3 shadow-sm">
    <%= form_with model: [model, block],
                  url: block.persisted? ? darwin.v2_model_block_path(model, block) : darwin.v2_model_blocks_path(model),
                  method: block.persisted? ? :patch : :post,
                  data: { turbo_frame: frame_id },
                  class: "space-y-3" do |form| %>
      <% if block.errors.any? %>
        <div class="rounded border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700">
          <%= block.errors.full_messages.to_sentence %>
        </div>
      <% end %>

      <div class="flex flex-col gap-1">
        <%= form.label :method_name, "Method", class: "text-sm font-medium text-slate-800" %>
        <%= form.text_field :method_name, class: "w-full rounded border px-2 py-1 text-sm" %>
      </div>

      <div class="flex flex-col gap-1">
        <%= form.label :args, "Args (JSON array or single value)", class: "text-sm font-medium text-slate-800" %>
        <%= form.text_field :args,
                            name: form.field_name(:args),
                            value: block.args.present? ? block.args.to_json : "[]",
                            class: "w-full rounded border px-2 py-1 text-sm font-mono" %>
      </div>

      <div class="flex flex-col gap-1">
        <%= form.label :options, "Options (JSON)", class: "text-sm font-medium text-slate-800" %>
        <%= form.text_area :options,
                           name: form.field_name(:options),
                           value: block.options.present? ? block.options.to_json : "{}",
                           class: "w-full rounded border px-2 py-2 text-sm font-mono",
                           rows: 3 %>
      </div>

      <div class="flex items-center justify-between">
        <span class="text-xs text-slate-500">
          Block ##{block.persisted? ? block.id : "new"}
        </span>
        <%= form.submit(block.persisted? ? "Update Block" : "Add Block", class: "rounded bg-slate-900 px-3 py-1 text-sm font-semibold text-white") %>
      </div>
    <% end %>
  </div>
<% end %>
